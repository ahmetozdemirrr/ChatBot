<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>

        body { font-family: Arial, sans-serif; }
        #chat-container { width: 100%; max-width: 600px; margin: 0 auto; }
        #messages { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; }
        #user-input { width: calc(100% - 20px); padding: 10px; }
        .button { padding: 10px; margin: 5px; background-color: #4CAF50; color: white; border: 1px solid #ccc; cursor: pointer; }
    
    </style>

</head>

<body>

    <div id="chat-container">

        <div id="messages"></div>
        <input type="text" id="user-input" placeholder="Type a message..." />
        <div id="buttons"></div>

    </div>

    <script>

        const messages = document.getElementById('messages');
        const userInput = document.getElementById('user-input');
        const buttonsDiv = document.getElementById('buttons');

        userInput.addEventListener('keypress', function (e) 
        {
            if (e.key === 'Enter') 
            {
                const userMessage = userInput.value;

                if (userMessage.trim() !== '') 
                {
                    appendMessage('User', userMessage);
                    fetchBotResponse(userMessage);
                    userInput.value = '';
                }
            }
        });

        function fetchBotResponse(message) 
        {
            fetch('/bot', 
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            })

            .then(response => response.json())
            .then(data => 
            {
                data.forEach(response => 
                {
                    if (typeof response.text === 'string' && isImageURL(response.text))
                    {
                        appendImage('Bot', response.text);
                    } 

                    else if (Array.isArray(response.text)) 
                    {
                        response.text.forEach(text => 
                        {
                            if (isImageURL(text)) 
                            {
                                appendImage('Bot', text);
                            } 

                            else 
                            {
                                appendMessage('Bot', text);
                            }
                        });
                    } 

                    else 
                    {
                        appendMessage('Bot', response.text);
                    }

                    if (response.buttons) 
                    {
                        showButtons(response.buttons);
                    }
                });
            })
            .catch(error => console.error('Error:', error));
        }

        function appendMessage(sender, text) 
        {
            const messageElement = document.createElement('div');

            messageElement.textContent = `${sender}: ${text}`;
            messages.appendChild(messageElement);
            messages.scrollTop = messages.scrollHeight;
        }

        function appendImage(sender, imageUrl) 
        {
            const messageElement = document.createElement('div');
            const imageElement = document.createElement('img');

            imageElement.src = imageUrl;
            messageElement.appendChild(imageElement);
            messages.appendChild(messageElement);
            messages.scrollTop = messages.scrollHeight;
        }

        function isImageURL(url) 
        {
            return (url.match(/\.(jpeg|jpg|gif|png|svg)$/) != null);
        }

        function showButtons(buttons) 
        {
            buttonsDiv.innerHTML = ''; // Mevcut butonları temizle

            buttons.forEach(button => 
            {
                const buttonElement = document.createElement('button');

                buttonElement.textContent = button.title;
                buttonElement.className = 'button';

                buttonElement.onclick = () => 
                {
                    appendMessage('User', button.title);
                    fetchBotResponse(button.payload);
                    buttonsDiv.innerHTML = ''; // Butonları temizle
                };
                buttonsDiv.appendChild(buttonElement);
            });
        }

    </script>

</body>
</html>
